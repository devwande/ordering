<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Writer Letter Input</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="header">
    <div class="logo">Enchant Gifts</div>
  </header>
  <div class="container">
    <h1>Writer Letter Input</h1>

    <form id="letterForm">
      <div>
        <label for="orderId">Order ID <span style="color: gray;">format(e.g 1023)</span>:</label>
        <input type="text" id="orderId" required>
      </div>
      <div id="contentContainer">
        <label for="content">Letter Content:</label>
        <textarea class="content" rows="5" required></textarea>
      </div>
      <button type="button" id="addContent">Add Another Letter</button>
      <div>
        <label for="type">Type:</label>
        <select name="type" id="type" required>
          <option value="regular">Regular</option>
          <option value="scroll">Scroll</option>
        </select>
      </div>
      <div>
        <label for="link">Digital Seal Link:</label>
        <input type="text" id="link" required>
      </div>
      <div enctype="multipart/form-data">
        <label for="polaroid">Polaroid Picture:</label>
        <input type="file" accept="image/*" id="polaroid" class="polaroid" multiple required>
      </div>
      <div>
        <label for="deliveryDate">Delivery Date:</label>
        <input type="date" id="deliveryDate" required>
      </div>
      <div>
        <label for="pin">Enter the security pin:</label>
        <input type="password" id="pin" required>
      </div>
      <button type="submit">Submit Letters</button>
    </form>
    <div id="result"></div>
  </div>

  <script>
    const letterForm = document.getElementById('letterForm');
    const resultDiv = document.getElementById('result');
    const addContentButton = document.getElementById('addContent');
    const contentContainer = document.getElementById('contentContainer');

    // Add functionality to dynamically add more content fields
    addContentButton.addEventListener('click', () => {
      const textarea = document.createElement('textarea');
      textarea.classList.add('content');
      textarea.rows = 5;
      textarea.required = true;
      contentContainer.appendChild(textarea);
    });

    letterForm.addEventListener('submit', async function (e) {
      e.preventDefault();
      const orderId = document.getElementById('orderId').value.trim();
      const contentElements = document.querySelectorAll('.content');
      const content = Array.from(contentElements).map((el) => el.value.trim());
      const type = document.getElementById('type').value.trim();
      const link = document.getElementById('link').value.trim();
      const polaroid = document.getElementById('polaroid').files[0];
      const deliveryDate = document.getElementById('deliveryDate').value.trim();
      const pin = document.getElementById('pin').value.trim();

      // Ensure all fields are filled
      if (!orderId || content.some((c) => !c) || !type || !link || !polaroid || !deliveryDate || !pin) {
        resultDiv.innerHTML = '<p class="error">All fields are required.</p>';
        return;
      }

      try {
        const response = await fetch('https://enchant-copy-production.up.railway.app/shopify/letter/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ orderId, content, type, link, polaroid, deliveryDate, pin }),
        });

        if (response.ok) {
          const data = await response.json();
          resultDiv.innerHTML = `<p class="success">${data.message}</p>`;
          letterForm.reset();
        } else {
          const errorData = await response.json();
          resultDiv.innerHTML = `<p class="error">${errorData.message}</p>`;
        }
      } catch (error) {
        console.error('Error:', error);
        resultDiv.innerHTML = '<p class="error">An error occurred while processing the letters. Please try again.</p>';
      }
    });
  </script>
</body>
</html>
